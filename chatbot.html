<!DOCTYPE html>
<html>
  <head>
    <title>Chat Bot</title>
  </head>
  <body>
    <div class="root"></div>
  </body>
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

    <script src="https://unpkg.com/supersimpledev/babel.js"></script>

    <script type="text/babel">
        function ChatInput({ chatMessages, setChatMessage }){
            const [inputText,setInputText]=React.useState("")
            
            function saveInputText(e){  
                setInputText(e.target.value) // fixed: use parameter e, not event
            }

            function sendMessage(){
                const newChatMessages=[
                    ...chatMessages,
                    {
                        message:inputText,
                        source:'user',
                        id:crypto.randomUUID()
                    }
                ]
                setChatMessage(newChatMessages)
                
                const response = Chatbot.getResponse(inputText)
                setChatMessage([
                    ...newChatMessages,
                    {
                        message:response,
                        source:'robot',
                        id:crypto.randomUUID()
                    }
                ])

                setInputText("") // clear input after sending CONTROLLED INPUT
            }
            return ( 
                <>
                    <input type="text" 
                    placeholder="Send a message to chatbot" 
                    size="25" 
                    value={inputText}   // controlled input
                    onChange={saveInputText}/>
                    <button onClick={sendMessage}>Send</button>
                </>
            );
        }

        function ChatMessage({message,source}) {
            /*
            if (source==="robot"){
                return (
                    <div>
                        <img src="robot.png" alt="robot profile" width="40" />
                        {message}
                    </div>
                );
            }
            */
            return (
                    <div>
                        {source==="robot" && <img src="robot.png" alt="robot profile " width="40" />}
                        {message}
                        {source === "user" && <img src="user.png" alt="user profile " width="40" />}
                    </div>
                );
            }


        function ChatMessages({chatMessages}){
            // Method -1
            // const chatMessageComponents = chatMessages.map((chatMessage)=>{
            //      return (
            //         <ChatMessage 
            //         message={chatMessage.message}
            //         source = {chatMessage.source}
            //         />
            //      );
            // })

            return(
                <>
                    {chatMessages.map((chatMessage)=>{
                        return(
                        <ChatMessage 
                            message={chatMessage.message}
                            source={chatMessage.source}
                            key={chatMessage.id}
                        />
                        );
                    })}
                </>
            );
        }


        function App(){
            const [chatMessages,setChatMessage]=React.useState([{
                message:'hello chatbot',
                source:'user',
                id:'id1'
            },{
                 message:"Hello! How can I help you?",
                 source:"robot",
                 id:'id2' 
            },{
                 message:"Fine what's today date?",
                 source:"user" ,
                 id:'id3'
            },{
                 message:"Today is August 21" ,
                 source:"robot",
                 id:'id4' 
            }]);
            
            // Array Destructuring:
            // const [chatMessages,setChatMessage]=array
            // const chatMessages=array[0]; //Current State
            // const setChatMessage = array[1]; /*Updater Function */
            return(
            <>
                <ChatInput 
                chatMessages={chatMessages}
                setChatMessage={setChatMessage} // fixed prop name
                />
                <ChatMessages 
                chatMessages={chatMessages}/>
                
            </>
            );
        }

      const Root = document.querySelector('.root');
      ReactDOM.createRoot(Root).render(<App />);
    </script>
</html>

